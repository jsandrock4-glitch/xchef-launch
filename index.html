<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XCHEF Subscribe â€” Fancy Thank You</title>
<style>
  :root{
    --accent:#ff4c00;
    --bg:#f8f9fa;
    --card:#ffffff;
    --text:#222;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, system-ui, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:24px;
  }

  /* Card with form */
  .card{
    width:100%;
    max-width:440px;
    background:var(--card);
    border-radius:12px;
    box-shadow:0 8px 30px rgba(0,0,0,0.08);
    padding:20px;
  }
  h1{color:var(--accent); margin:0 0 12px 0; text-align:center}
  form{display:flex; flex-direction:column; gap:12px}
  input, select, button{
    padding:10px 12px; border-radius:8px; border:1px solid #ddd; font-size:1rem;
  }
  button{
    background:var(--accent); color:#fff; border:0; cursor:pointer; font-weight:700;
  }
  button:active{transform:translateY(1px)}

  /* Status area */
  #statusMessage{ margin-top:12px; text-align:center; font-weight:700 }

  /* Overlay / thank-you popup */
  .overlay{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none; /* disabled until active */
    z-index:1200;
  }
  .overlay.active{ pointer-events:auto; }

  .popup{
    width:90%;
    max-width:520px;
    background:linear-gradient(180deg, rgba(255,255,255,0.96), #fff);
    border-radius:16px;
    padding:28px;
    box-shadow:0 20px 60px rgba(0,0,0,0.18);
    text-align:center;
    position:relative;
    overflow:visible;
  }

  /* Coin container */
  .coin-wrap{
    width:140px; height:140px;
    margin:0 auto 18px auto;
    position:relative;
    transform-style:preserve-3d;
    perspective:800px;
  }

  /* The coin (circle) */
  .coin{
    width:100%; height:100%;
    border-radius:50%;
    background:conic-gradient(from 180deg, #ffd27a, #ffb44d 40%, #ff7b1a 80%);
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 12px 30px rgba(255,92,20,0.18), inset 0 -8px 16px rgba(0,0,0,0.08);
    transform-origin:center center;
    animation:spin 2s linear infinite;
    position:relative;
  }

  /* coin inner badge (logo or letter) */
  .coin .badge{
    width:60%; height:60%;
    border-radius:50%;
    background:rgba(255,255,255,0.95);
    display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:22px; color:var(--accent);
    box-shadow:0 6px 14px rgba(0,0,0,0.12);
    transform:translateZ(18px) rotateX(30deg);
    overflow:hidden;
  }

  /* Sparks around coin */
  .spark{
    position:absolute;
    width:10px; height:10px;
    background:linear-gradient(180deg,#fff8d9,#ffd86b);
    border-radius:50%;
    filter:blur(0.4px);
    opacity:0;
    transform:translate(-50%,-50%) scale(.6);
    animation:pop 1s linear infinite;
  }
  /* position multiple sparks via nth-child */
  .spark:nth-child(1){ left:10%; top:10%; animation-delay:0s }
  .spark:nth-child(2){ left:90%; top:20%; animation-delay:.12s }
  .spark:nth-child(3){ left:20%; top:85%; animation-delay:.24s }
  .spark:nth-child(4){ left:80%; top:80%; animation-delay:.36s }
  .spark:nth-child(5){ left:50%; top:2%; animation-delay:.6s }

  @keyframes pop{
    0%{ opacity:0; transform:translate(-50%,-50%) scale(.4) translateY(0) }
    30%{ opacity:1; transform:translate(-50%,-50%) scale(1.1) translateY(-6px) }
    100%{ opacity:0; transform:translate(-50%,-50%) scale(.2) translateY(-40px) }
  }

  @keyframes spin{
    0%{ transform:rotateY(0) rotateX(6deg) }
    100%{ transform:rotateY(360deg) rotateX(6deg) }
  }

  .title{
    font-size:20px; font-weight:800; margin:6px 0 0 0;
  }
  .subtitle{ color:#666; margin-top:6px; font-weight:600 }

  .close-btn{
    margin-top:18px;
    background:#222; color:#fff; padding:10px 16px; border-radius:10px; border:0; cursor:pointer;
  }

  /* small responsive tweaks */
  @media (max-width:420px){
    .coin-wrap{ width:120px; height:120px }
    .badge{ font-size:18px }
  }
</style>
</head>
<body>

  <div class="card" id="card">
    <h1>XCHEF Bonus Coins</h1>

    <form id="subscriptionForm">
      <input type="text" name="firstname" placeholder="First Name" required>
      <input type="text" name="lastname" placeholder="Last Name" required>

      <select name="province" required>
        <option value="">Select Province</option>
        <option>Gauteng</option>
        <option>KwaZulu-Natal</option>
        <option>Western Cape</option>
        <option>Eastern Cape</option>
        <option>Limpopo</option>
        <option>Mpumalanga</option>
        <option>North West</option>
        <option>Free State</option>
        <option>Northern Cape</option>
      </select>

      <input type="tel" name="cell" placeholder="+27 82 123 4567"
             pattern="[0-9\s+()\-]{7,20}" required>
      <input type="text" name="wallet" placeholder="Wallet Address" required>

      <button type="submit">Subscribe</button>
    </form>

    <p id="statusMessage"></p>
  </div>

  <!-- Overlay / popup shown after success -->
  <div class="overlay" id="overlay" aria-hidden="true" role="dialog" aria-label="Subscription Success">
    <div class="popup" id="popup" style="opacity:0; transform:translateY(10px) scale(.98); transition:all .36s ease;">
      <div class="coin-wrap" aria-hidden="true">
        <div class="coin" id="coin">
          <div class="badge" id="badge">X</div>
          <div class="spark"></div>
          <div class="spark"></div>
          <div class="spark"></div>
          <div class="spark"></div>
          <div class="spark"></div>
        </div>
      </div>

      <div class="title" id="popupTitle">YOU ARE SUBSCRIBED</div>
      <div class="subtitle" id="popupSubtitle">Thank you â€” welcome to the XCHEF family! ðŸŽ‰</div>

      <button class="close-btn" id="closeBtn">Close</button>
    </div>
  </div>

<script>
  const form = document.getElementById('subscriptionForm');
  const status = document.getElementById('statusMessage');
  const overlay = document.getElementById('overlay');
  const popup = document.getElementById('popup');
  const closeBtn = document.getElementById('closeBtn');
  const coinBadge = document.getElementById('badge');

  // Replace this with your deployed Apps Script URL
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyxeCXU8HnoRIza5gzyHAgTqv6h3AkQF1h83LO1O0usckgJi5OhVItg00JiTvPMayVe/exec';

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    status.textContent = "";
    status.style.color = "";

    // build payload
    const payload = {
      ts: new Date().toISOString(),
      firstname: form.firstname.value.trim(),
      lastname: form.lastname.value.trim(),
      province: form.province.value,
      cell: form.cell.value.trim(),
      wallet: form.wallet.value.trim()
    };

    try {
      const res = await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });

      // If script returns plain text "Success", handle it; prefer JSON if possible
      let data;
      const contentType = res.headers.get('content-type') || '';
      if (contentType.includes('application/json')) {
        data = await res.json();
      } else {
        // fallback for plain text responses
        const txt = await res.text();
        data = (txt && txt.toLowerCase().includes('success')) ? {status:'success'} : {status:'error', message: txt};
      }

      if (data.status === 'success') {
        // show animated popup
        showPopup(payload.firstname);
        form.reset();
      } else {
        status.textContent = "Error: " + (data.message || "Please try again");
        status.style.color = "red";
      }

    } catch (err) {
      console.error(err);
      status.textContent = "Error: Could not connect to server.";
      status.style.color = "red";
    }
  });

  function showPopup(firstname = "") {
    // personalize badge or title if you want
    if (firstname) {
      document.getElementById('popupSubtitle').textContent = `Thanks, ${firstname}! Welcome to XCHEF ðŸŽ‰`;
      coinBadge.textContent = firstname[0] ? firstname[0].toUpperCase() : 'X';
    } else {
      document.getElementById('popupSubtitle').textContent = 'Thank you â€” welcome to the XCHEF family! ðŸŽ‰';
      coinBadge.textContent = 'X';
    }

    overlay.classList.add('active');
    overlay.setAttribute('aria-hidden','false');

    // animate popup in
    requestAnimationFrame(()=> {
      popup.style.opacity = '1';
      popup.style.transform = 'translateY(0) scale(1)';
    });

    // optional: auto close after 6 seconds
    window._autoCloseTimer = setTimeout(hidePopup, 6000);
  }

  function hidePopup() {
    popup.style.opacity = '0';
    popup.style.transform = 'translateY(10px) scale(.98)';
    overlay.setAttribute('aria-hidden','true');
    // wait for transition then remove active class
    setTimeout(()=> overlay.classList.remove('active'), 360);
    // clear timer if exists
    if (window._autoCloseTimer) {
      clearTimeout(window._autoCloseTimer);
      window._autoCloseTimer = null;
    }
  }

  // close button
  closeBtn.addEventListener('click', hidePopup);

  // accessibility: close on Escape
  document.addEventListener('keydown', (e)=> {
    if (e.key === 'Escape' && overlay.classList.contains('active')) hidePopup();
  });
</script>
</body>
</html>
